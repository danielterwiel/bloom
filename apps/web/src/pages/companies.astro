---
import BaseLayout from "../layouts/BaseLayout.astro";
import { CompanyExplorer } from "../components/react/CompanyExplorer";
---

<BaseLayout
  title="Browse Companies | Bloom"
  description="Explore our comprehensive directory of 1000+ flower industry companies. Filter by category, location, specialty, and more."
>
  <!-- Hero Section -->
  <section class="relative overflow-hidden py-section">
    <!-- Decorative background elements -->
    <div class="absolute inset-0 -z-10">
      <div
        class="absolute top-10 left-20 w-72 h-72 rounded-full bg-primary/5 blur-3xl"
      >
      </div>
      <div
        class="absolute bottom-10 right-20 w-64 h-64 rounded-full bg-secondary/5 blur-3xl"
      >
      </div>
      <div
        class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 rounded-full bg-accent/5 blur-3xl"
      >
      </div>
    </div>

    <div class="mx-auto max-w-4xl px-content text-center">
      <!-- Building icon -->
      <div
        class="mx-auto mb-6 flex h-16 w-16 items-center justify-center rounded-full bg-primary/10"
      >
        <svg
          class="h-8 w-8 text-primary"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
          ></path>
        </svg>
      </div>

      <h1
        class="font-heading text-4xl font-bold tracking-tight text-foreground sm:text-5xl"
      >
        Browse <span class="text-primary">Companies</span>
      </h1>
      <p class="mt-6 text-lg text-foreground-muted">
        Discover and explore over 1,000 flower industry companies from around
        the world. Use filters to find exactly what you're looking for.
      </p>
    </div>
  </section>

  <!-- Company Explorer Section -->
  <section class="bg-surface py-section">
    <div class="mx-auto max-w-7xl px-content">
      <!-- Loading state shown before hydration -->
      <div id="explorer-loading" class="explorer-loading">
        <div class="rounded-card bg-background p-card shadow-card">
          <div class="flex items-center justify-center py-16">
            <div class="text-center">
              <!-- Animated loading spinner -->
              <div
                class="mx-auto mb-4 h-10 w-10 animate-spin rounded-full border-4 border-muted border-t-primary"
              >
              </div>
              <p class="text-sm text-foreground-muted">
                Loading company explorer...
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- React Island - hydrates immediately with client:load -->
      <div id="explorer-container" class="explorer-container">
        <CompanyExplorer client:load />
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  /* View Transition animations */
  h1 {
    view-transition-name: companies-title;
  }

  /* Show loading state initially, hide after hydration */
  .explorer-loading {
    display: block;
  }

  .explorer-container {
    display: none;
  }

  /* After hydration, the React component replaces loading state */
  :global(.astro-island-loaded) + .explorer-loading {
    display: none;
  }

  :global(.astro-island-loaded) .explorer-container,
  .explorer-container:has(> *) {
    display: block;
  }
</style>

<script>
  // Hide loading state when the React component has mounted
  function hideLoadingState() {
    const loading = document.getElementById("explorer-loading");
    const container = document.getElementById("explorer-container");

    if (loading && container) {
      // Check if the container has content (React has hydrated)
      const observer = new MutationObserver((_mutations, obs) => {
        if (container.querySelector("[data-hydrated]") || container.children.length > 0) {
          loading.style.display = "none";
          container.style.display = "block";
          obs.disconnect();
        }
      });

      observer.observe(container, { childList: true, subtree: true });

      // Also set a timeout as fallback
      setTimeout(() => {
        loading.style.display = "none";
        container.style.display = "block";
        observer.disconnect();
      }, 100);
    }
  }

  // Run on initial load
  hideLoadingState();

  // Run after View Transitions
  document.addEventListener("astro:after-swap", hideLoadingState);
</script>
